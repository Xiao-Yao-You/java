<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hk.jigai.module.system.dal.mysql.meetingroominfo.UserBookMeetingMapper">
    <select id="selectCount1" parameterType="map" resultType="Integer">
        select count(distinct a.id)
        from hk_user_book_meeting a join hk_meeting_person_attend_record b on a.id = b.meeting_book_id and b.deleted=0
        where a.deleted=0
        <if test="userPhone != null and userPhone != ''">
            and a.user_phone = #{userPhone}
        </if>
        <if test="meetingRoomId != null">
            and a.meeting_room_id = #{meetingRoomId}
        </if>
        <if test="capacityList != null and capacityList.length >1">
            and a.capacity between #{capacityList[${0}]} and #{capacityList[${1}]}
        </if>
        <if test="subject != null">
            and a.subject like CONCAT('%' , #{subject} , '%')
        </if>
        <if test="date != null and date.length >1">
            and a.date_meeting between #{date[${0}]} and #{date[${1}]}
        </if>
        <if test="userId != null and userId != ''">
            and (a.user_id = #{userId} or b.user_id = #{userId})
        </if>
    </select>

    <select id="selectPage" parameterType="map" resultMap="bookMeetingMap">
        select distinct a.id,a.user_id,a.user_nick_name,a.user_phone,a.host_user_nick_name,a.meeting_room_id,
        a.meeting_room_name,a.subject,a.date_meeting,a.start_time,a.end_time,a.equipment,
        a.capacity,a.remark,a.status
        from hk_user_book_meeting a join hk_meeting_person_attend_record b on a.id = b.meeting_book_id and b.deleted=0
        where a.deleted=0
        <if test="userPhone != null and userPhone != ''">
            and a.user_phone = #{userPhone}
        </if>
        <if test="meetingRoomId != null">
            and a.meeting_room_id = #{meetingRoomId}
        </if>
        <if test="capacityList != null and capacityList.length >1">
            and a.capacity between #{capacityList[${0}]} and #{capacityList[${1}]}
        </if>
        <if test="subject != null and subject != ''">
            and a.subject like CONCAT('%' , #{subject} , '%')
        </if>
        <if test="date != null and date.length >1">
            and a.date_meeting between #{date[${0}]} and #{date[${1}]}
        </if>
        <if test="userId != null and userId != ''">
            and (a.user_id = #{userId} or b.user_id = #{userId})
        </if>
        order by a.status,a.date_meeting desc
        LIMIT #{offset},#{pageSize}
    </select>

    <resultMap id="bookMeetingMap" type="com.hk.jigai.module.system.dal.dataobject.meetingroominfo.UserBookMeetingDO">
        <id property="id" column="id"/>
        <result property="userId" column="user_id"/>
        <result property="userNickName" column="user_nick_name"/>
        <result property="hostUserNickName" column="host_user_nick_name"/>
        <result property="userPhone" column="user_phone"/>
        <result property="meetingRoomId" column="meeting_room_id"/>
        <result property="meetingRoomName" column="meeting_room_name"/>
        <result property="subject" column="subject"/>
        <result property="dateMeeting" column="date_meeting"/>
        <result property="startTime" column="start_time"/>
        <result property="endTime" column="end_time"/>
        <result property="equipment" column="equipment" typeHandler="com.hk.jigai.framework.mybatis.core.type.JsonStringSetTypeHandler"/>
        <result property="capacity" column="capacity"/>
        <result property="remark" column="remark"/>
        <result property="status" column="status"/>
    </resultMap>
</mapper>